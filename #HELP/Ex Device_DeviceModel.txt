Perfeito, Gilmar! Vamos montar uma Minimal API completa com:
âœ… Estrutura organizada
âœ… Entidades Device e DeviceModel
âœ… ValidaÃ§Ã£o com FluentValidation
âœ… PersistÃªncia com Entity Framework Core + SQLite
âœ… Swagger para documentaÃ§Ã£o
âœ… Testes com xUnit

ğŸ§± Estrutura de Pastas
/Dtos
  â”œâ”€â”€ CreateDeviceDto.cs
  â””â”€â”€ CreateDeviceModelDto.cs
/Validators
  â”œâ”€â”€ CreateDeviceDtoValidator.cs
  â””â”€â”€ CreateDeviceModelDtoValidator.cs
/Endpoints
  â”œâ”€â”€ DeviceEndpoints.cs
  â””â”€â”€ DeviceModelEndpoints.cs
/Services
  â”œâ”€â”€ DeviceService.cs
  â””â”€â”€ DeviceModelService.cs
/Data
  â””â”€â”€ AppDbContext.cs
/Models
  â”œâ”€â”€ Device.cs
  â””â”€â”€ DeviceModel.cs
/ValueObjects
  â”œâ”€â”€ ComputerName.cs
  â””â”€â”€ MacAddress.cs
/Repositories
  â”œâ”€â”€ DeviceRepository.cs
  â””â”€â”€ DeviceModelRepository.cs
/Tests
  â””â”€â”€ DeviceTests.cs
Program.cs

î·›î·œ

ğŸ§© 1. Models e Value Objects
Device.cs e DeviceModel.cs
VocÃª jÃ¡ forneceu essas classes â€” vamos mantÃª-las como estÃ£o.
ComputerName.cs e MacAddress.cs (Value Objects)
namespace ValueObjects;

public record ComputerName(string Value)
{
    public static ComputerName Create(string value)
    {
        if (string.IsNullOrWhiteSpace(value))
            throw new ArgumentException("Computer name is required.");
        return new ComputerName(value.Trim());
    }
}

public record MacAddress(string Value)
{
    public static MacAddress Create(string value)
    {
        if (string.IsNullOrWhiteSpace(value))
            throw new ArgumentException("MAC address is required.");
        return new MacAddress(value.Trim().ToUpper());
    }
}

î·›î·œ

ğŸ“¦ 2. DTOs
CreateDeviceDto.cs
namespace Dtos;

public record CreateDeviceDto(
    string ComputerName,
    string SerialNumber,
    string MacAddress,
    Guid DeviceModelId);


CreateDeviceModelDto.cs
namespace Dtos;

public record CreateDeviceModelDto(
    string Manufacturer,
    string Model,
    string Type);



âœ… 3. Validadores
CreateDeviceDtoValidator.cs
using Dtos;
using FluentValidation;

namespace Validators;

public class CreateDeviceDtoValidator : AbstractValidator<CreateDeviceDto>
{
    public CreateDeviceDtoValidator()
    {
        RuleFor(x => x.ComputerName).NotEmpty();
        RuleFor(x => x.SerialNumber).NotEmpty();
        RuleFor(x => x.MacAddress).NotEmpty();
        RuleFor(x => x.DeviceModelId).NotEmpty();
    }
}


CreateDeviceModelDtoValidator.cs
using Dtos;
using FluentValidation;

namespace Validators;

public class CreateDeviceModelDtoValidator : AbstractValidator<CreateDeviceModelDto>
{
    public CreateDeviceModelDtoValidator()
    {
        RuleFor(x => x.Manufacturer).NotEmpty();
        RuleFor(x => x.Model).NotEmpty();
        RuleFor(x => x.Type).NotEmpty();
    }
}

î·™î·š

ğŸ—ƒï¸ 4. RepositÃ³rios
DeviceRepository.cs
using Data;
using Microsoft.EntityFrameworkCore;
using Models;

namespace Repositories;

public class DeviceRepository
{
    private readonly AppDbContext _context;

    public DeviceRepository(AppDbContext context) => _context = context;

    public async Task AddAsync(Device device)
    {
        _context.Devices.Add(device);
        await _context.SaveChangesAsync();
    }

    public async Task<List<Device>> GetAllAsync() =>
        await _context.Devices.Include(d => d.DeviceModel).ToListAsync();
}

î·›î·œ
DeviceModelRepository.cs
using Data;
using Microsoft.EntityFrameworkCore;
using Models;

namespace Repositories;

public class DeviceModelRepository
{
    private readonly AppDbContext _context;

    public DeviceModelRepository(AppDbContext context) => _context = context;

    public async Task AddAsync(DeviceModel model)
    {
        _context.DeviceModels.Add(model);
        await _context.SaveChangesAsync();
    }

    public async Task<DeviceModel?> GetByIdAsync(Guid id) =>
        await _context.DeviceModels.FindAsync(id);
}

î·›î·œî·™î·š

âš™ï¸ 5. ServiÃ§os
DeviceService.cs
using Dtos;
using Models;
using Repositories;
using ValueObjects;

namespace Services;

public class DeviceService
{
    private readonly DeviceRepository _deviceRepo;
    private readonly DeviceModelRepository _modelRepo;

    public DeviceService(DeviceRepository deviceRepo, DeviceModelRepository modelRepo)
    {
        _deviceRepo = deviceRepo;
        _modelRepo = modelRepo;
    }

    public async Task<Device> CreateAsync(CreateDeviceDto dto)
    {
        var model = await _modelRepo.GetByIdAsync(dto.DeviceModelId)
            ?? throw new ArgumentException("Device model not found.");

        var device = new Device(dto.ComputerName, dto.SerialNumber, dto.MacAddress, model);
        await _deviceRepo.AddAsync(device);
        return device;
    }

    public Task<List<Device>> GetAllAsync() => _deviceRepo.GetAllAsync();
}

î·›î·œî·™î·š
DeviceModelService.cs
using Dtos;
using Models;
using Repositories;

namespace Services;

public class DeviceModelService
{
    private readonly DeviceModelRepository _repo;

    public DeviceModelService(DeviceModelRepository repo) => _repo = repo;

    public async Task<DeviceModel> CreateAsync(CreateDeviceModelDto dto)
    {
        var model = new DeviceModel(dto.Manufacturer, dto.Model, dto.Type);
        await _repo.AddAsync(model);
        return model;
    }
}

î·›î·œ

ğŸŒ 6. Endpoints
DeviceEndpoints.cs
using Dtos;
using FluentValidation;
using Microsoft.AspNetCore.Http.HttpResults;
using Services;

namespace Endpoints;

public static class DeviceEndpoints
{
    public static void MapDeviceEndpoints(this IEndpointRouteBuilder app)
    {
        app.MapPost("/devices", async (
            CreateDeviceDto dto,
            IValidator<CreateDeviceDto> validator,
            DeviceService service) =>
        {
            var validation = await validator.ValidateAsync(dto);
            if (!validation.IsValid)
                return Results.BadRequest(validation.Errors);

            var device = await service.CreateAsync(dto);
            return Results.Created($"/devices/{device.Id}", device);
        });

        app.MapGet("/devices", async (DeviceService service) =>
        {
            var devices = await service.GetAllAsync();
            return Results.Ok(devices);
        });
    }
}

î·›î·œ
DeviceModelEndpoints.cs
using Dtos;
using FluentValidation;
using Microsoft.AspNetCore.Http.HttpResults;
using Services;

namespace Endpoints;

public static class DeviceModelEndpoints
{
    public static void MapDeviceModelEndpoints(this IEndpointRouteBuilder app)
    {
        app.MapPost("/device-models", async (
            CreateDeviceModelDto dto,
            IValidator<CreateDeviceModelDto> validator,
            DeviceModelService service) =>
        {
            var validation = await validator.ValidateAsync(dto);
            if (!validation.IsValid)
                return Results.BadRequest(validation.Errors);

            var model = await service.CreateAsync(dto);
            return Results.Created($"/device-models/{model.Id}", model);
        });
    }
}

î·›î·œî·™î·š

ğŸ—ƒï¸ 7. EF Core + SQLite
AppDbContext.cs
using Microsoft.EntityFrameworkCore;
using Models;

namespace Data;

public class AppDbContext : DbContext
{
    public AppDbContext(DbContextOptions<AppDbContext> options) : base(options) { }

    public DbSet<Device> Devices => Set<Device>();
    public DbSet<DeviceModel> DeviceModels => Set<DeviceModel>();
}

î·™î·š

ğŸš€ 8. Program.cs
using Data;
using Endpoints;
using FluentValidation;
using FluentValidation.AspNetCore;
using Microsoft.EntityFrameworkCore;
using Repositories;
using Services;
using Validators;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddDbContext<AppDbContext>(opt =>
    opt.UseSqlite("Data Source=devices.db"));

builder.Services.AddScoped<DeviceRepository>();
builder.Services.AddScoped<DeviceModelRepository>();
builder.Services.AddScoped<DeviceService>();
builder.Services.AddScoped<DeviceModelService>();

builder.Services.AddValidatorsFromAssemblyContaining<CreateDeviceDtoValidator>();
builder.Services.AddFluentValidationAutoValidation();

builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

var app = builder.Build();

app.UseSwagger();
app.UseSwaggerUI();

app.MapDeviceEndpoints();
app.MapDeviceModelEndpoints();

app.Run();

î·›î·œî·™î·š

ğŸ§ª 9. Testes com xUnit (DeviceTests.cs)
using Models;
using Xunit;

namespace Tests;

public class DeviceTests
{
    [Fact]
    public void Should_Create_Device_With_Valid_Data()
    {
        var model = new DeviceModel("Dell", "XPS 13", "Laptop");
        var device = new Device("PC-01", "ABC123", "00:11:22:33:44:55", model);

        Assert.Equal("ABC123", device.SerialNumber);
        Assert.Equal("00:11:22:33:44:55", device.MacAddress.Value);
        Assert.Equal("PC-01", device.ComputerName.Value);
        Assert.Equal(model, device.DeviceModel);
    }
}

î·›î·œî·™î·š

Se quiser, posso te ajudar a criar um script para popular o banco com dados iniciais ou configurar testes de integraÃ§Ã£o com banco em memÃ³ria. Quer seguir por
